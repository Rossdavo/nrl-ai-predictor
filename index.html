<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>NRL AI Predictions</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --header: #f9fafb;
      --pos: #ecfdf5;
      --neg: #fef2f2;
      --card: #ffffff;
      --shadow: 0 6px 20px rgba(0,0,0,.06);
    }

    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 28px; background: var(--bg); color: var(--text); }
    h1 { margin: 0 0 6px 0; font-size: 28px; }
    h2 { margin-top: 28px; font-size: 18px; }
    .note { color: var(--muted); margin-top: 6px; }
    .small { font-size: 12px; color: var(--muted); margin-top: 18px; }

    .wrap { max-width: 1100px; margin: 0 auto; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px; box-shadow: var(--shadow); }

    .downloads ul { display: flex; flex-wrap: wrap; gap: 10px; padding-left: 18px; }
    .downloads a { text-decoration: none; border: 1px solid var(--border); padding: 8px 10px; border-radius: 10px; color: var(--text); background: var(--header); }
    .downloads a:hover { filter: brightness(0.98); }

    table { border-collapse: separate; border-spacing: 0; width: 100%; margin-top: 14px; font-size: 14px; }
    th, td { border-bottom: 1px solid var(--border); padding: 10px 12px; vertical-align: top; }
    th { position: sticky; top: 0; background: var(--header); text-align: left; font-weight: 650; z-index: 2; border-top: 1px solid var(--border); }
    tr:nth-child(even) td { background: #fcfcfd; }

    .badge { display: inline-block; padding: 3px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); background: var(--header); }
    .badge-home { background: #eef2ff; }
    .badge-away { background: #fff7ed; }

    .row-pos td { background: var(--pos) !important; }
    .row-neg td { background: var(--neg) !important; }
    .muted { color: var(--muted); }

    @media (max-width: 900px) {
      body { margin: 14px; }
      table { font-size: 13px; }
      th, td { padding: 8px 10px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>NRL AI Predictions</h1>
      <p class="small">INDEX VERSION: LIVE CSV LOADER (2026-02-21)</p>
      <p class="note">Automated predictions with model probabilities, odds comparison, value detection, and staking suggestions.</p>

      <div class="downloads">
        <h2>Downloads</h2>
        <ul>
          <li><a href="predictions.csv" target="_blank" rel="noopener">Predictions CSV</a></li>
          <li><a href="odds.csv" target="_blank" rel="noopener">Odds CSV</a></li>
          <li><a href="bet_log.csv" target="_blank" rel="noopener">Bet Log CSV</a></li>
          <li><a href="accuracy.csv" target="_blank" rel="noopener">Accuracy CSV</a></li>
          <li><a href="performance.csv" target="_blank" rel="noopener">Performance CSV</a></li>
          <li><a href="closing_odds.csv" target="_blank" rel="noopener">Closing Odds CSV</a></li>
          <li><a href="bankroll_status.csv" target="_blank" rel="noopener">Bankroll Status CSV</a></li>
          <li><a href="predictions_history.csv" target="_blank" rel="noopener">Predictions History CSV</a></li>
          <li><a href="odds_history.csv" target="_blank" rel="noopener">Odds History CSV</a></li>
          <li><a href="results_cache.csv" target="_blank" rel="noopener">Results Cache CSV</a></li>
          <li><a href="ratings.json" target="_blank" rel="noopener">Ratings JSON</a></li>
        </ul>
      </div>
    </div>

    <!-- LIVE predictions table (loads from predictions.csv) -->
    <div class="card" style="margin-top:16px;">
      <div id="pred-table" class="muted">Loading predictionsâ€¦</div>
    </div>

    <div class="card" style="margin-top:16px;">
      <p class="note"><b>Results &amp; Accuracy:</b> No completed matches scored yet.</p>
    </div>

    <div class="card" style="margin-top:16px;">
      <p class="note"><b>CLV &amp; ROI:</b> Nothing to report yet.</p>
    </div>

    <p class="small">Generated automatically via GitHub Actions.</p>
  </div>

  <script>
    async function loadCSV(path) {
      // Cache-bust so you always see the newest deployed file
      const res = await fetch(path + "?v=" + Date.now());
      if (!res.ok) throw new Error("Failed to load " + path);
      return await res.text();
    }

    // Simple CSV parser (works for your current files: no commas inside fields)
    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(",").map(h => h.trim());
      const rows = lines.slice(1).map(line => {
        const cols = line.split(",");
        const obj = {};
        headers.forEach((h, i) => obj[h] = (cols[i] ?? "").trim());
        return obj;
      });
      return { headers, rows };
    }

    function renderTable(headers, rows) {
      const preferred = [
        "date","kickoff_local","home","away","home_win_prob","confidence",
        "home_odds","away_odds","value_flag","pick","edge","stake",
        "home_top_try","away_top_try"
      ];
      const keep = preferred.filter(h => headers.includes(h));

      return `
        <table>
          <thead>
            <tr>${keep.map(h => `<th>${h}</th>`).join("")}</tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                ${keep.map(h => `<td>${(r[h] ?? "")}</td>`).join("")}
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    (async () => {
      const el = document.getElementById("pred-table");
      try {
        const csv = await loadCSV("predictions.csv");
        const { headers, rows } = parseCSV(csv);

        // Hide past dates (keeps trials out forever)
        const today = new Date(); today.setHours(0,0,0,0);
        const filtered = rows.filter(r => {
          const d = new Date((r.date || "") + "T00:00:00");
          return !isNaN(d) && d >= today;
        });

        el.classList.remove("muted");
        el.innerHTML = renderTable(headers, filtered.length ? filtered : rows);
      } catch (e) {
        el.innerHTML = "Could not load predictions.csv";
        console.error(e);
      }
    })();
  </script>
</body>
</html>
